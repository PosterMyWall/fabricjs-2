!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@postermywall/fabricjs-2")):"function"==typeof define&&define.amd?define(["exports","@postermywall/fabricjs-2"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).fabricExtensions={},t["@postermywall/fabricjs-2"])}(this,(function(t,e){"use strict";const n={margin:4,width:1,color:"rgb(255,0,0,0.9)",drawX:!1};function o(t,e,o){const{width:r,color:c}=n,s=t.getSelectionContext(),a=t.viewportTransform,f=t.getZoom();s.save(),s.transform(...a),s.lineWidth=r/f,s.strokeStyle=c,s.setLineDash([5,3]),s.beginPath(),s.moveTo(e.x,e.y),s.lineTo(o.x,o.y),s.stroke(),i(s,f,e),i(s,f,o),s.restore()}const r=2.4;function i(t,e,o){if(!n.drawX)return;const i=r/e;t.save(),t.translate(o.x,o.y),t.beginPath(),t.moveTo(-i,-i),t.lineTo(i,i),t.moveTo(i,-i),t.lineTo(-i,i),t.stroke(),t.restore()}function c(t,o){!function(t,e){const{width:o,color:r}=n,c=t.getSelectionContext(),s=t.viewportTransform,a=t.getZoom();c.save(),c.transform(...s),c.lineWidth=o/a,c.strokeStyle=r;for(const t of e)i(c,a,t);c.restore()}(t,o.map((t=>{const n="y2"in t,o=n?t.x:t.x1,r=n?t.y1:t.y;return new e.Point(o,r)})))}function s(t,n){const r=n.x;o(t,new e.Point(r,n.y1),new e.Point(r,n.y2))}function a(t,n){const r=n.y;o(t,new e.Point(n.x1,r),new e.Point(n.x2,r))}function f(t){const n=new Set,o=t.canvas;if(!o)return n;const r=t instanceof e.ActiveSelection?t.getObjects():[t];return o.forEachObject((t=>{t.isOnScreen()&&t.visible&&(t.constructor!=e.Group?n.add(t):u(n,t))})),l(n,r),n}function l(t,n){for(const o of n)o.constructor==e.Group?l(t,o.getObjects()):t.delete(o)}function u(t,n){const o=n.getObjects();for(const n of o)n.visible&&(n.constructor!=e.Group?t.add(n):u(t,n))}function d(t){var e,o;const r=n.margin,{activeObject:i,activeObjectRect:c,objectRect:s}=t,a={target:i,list:x(s),aList:x(c),margin:r/(null!==(e=null===(o=i.canvas)||void 0===o?void 0:o.getZoom())&&void 0!==e?e:1)},f=function(t){const{target:e,list:n,aList:o,margin:r}=t,i=o.map((t=>g(t,n,"x"))),c=Math.min(...i.map((t=>t.dis)));if(c>r)return[];const s=[],a=o[0].x2-o[0].x,f=o[0].y2-o[0].y;let l=!1;for(let t=0;t<i.length;t++){const r=i[t];if(c==r.dis){const i=n[r.index],u=o[r.index],d=i.x,g=u.y,x=Math.min(i.y,i.y2,g,u.y2),y=Math.max(i.y,i.y2,g,u.y2);if(s.push({x:d,y1:x,y2:y}),l)continue;l=!0,h({target:e,x:d,y:g,centerX:t-1,centerY:r.index-1,width:a,height:f,dir:"x"});const m=c*r.dir;o.forEach((t=>t.x-=m))}}return s}(a),l=function(t){const{target:e,list:n,aList:o,margin:r}=t,i=o.map((t=>g(t,n,"y"))),c=Math.min(...i.map((t=>t.dis)));if(c>r)return[];const s=[],a=o[0].x2-o[0].x,f=o[0].y2-o[0].y;let l=!1;for(let t=0;t<i.length;t++){const r=i[t];if(c==r.dis){const i=n[r.index],u=o[r.index],d=i.y,g=u.x,x=Math.min(i.x,i.x2,g,u.x2),y=Math.max(i.x,i.x2,g,u.x2);if(s.push({y:d,x1:x,x2:y}),l)continue;l=!0,h({target:e,x:g,y:d,centerX:r.index-1,centerY:t-1,width:a,height:f,dir:"y"});const m=c*r.dir;o.forEach((t=>t.y-=m))}}return s}(a);return{vLines:f,hLines:l}}function g(t,e,n){let o=1/0,r=-1,i=1;for(let a=0;a<e.length;a++){const f=(c=t[n],s=e[a][n],Math.abs(c-s));o>f&&(r=a,o=f,i=t[n]>e[a][n]?1:-1)}var c,s;return{dis:o,index:r,dir:i}}function x(t){const{left:e,top:n,width:o,height:r}=t,i=e+o/2,c=n+r/2;return[{x:e,y:n,x2:e+o,y2:n+r},{x:i,y:c,x2:i,y2:c},{x:e+o,x2:e,y:n+r,y2:n}]}function h(t){const{target:n,centerX:o,centerY:r,width:i,height:c,dir:s}=t;let{x:a,y:f}=t;a-=o*i/2,f-=r*c/2,function(t,e,n){const o=t.translateToCenterPoint(e,"center","center"),r=t.translateToOriginPoint(o,t.originX,t.originY);"x"==n?t.setX(r.x):t.setY(r.y)}(n,new e.Point(a,f),s),n.setCoords()}const y=function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"top";return async function(r){const{originX:i=n,originY:c=o}=r;delete r.originX,delete r.originY;for(var s=arguments.length,a=new Array(s>1?s-1:0),f=1;f<s;f++)a[f-1]=arguments[f];const l=await t.call(this,r,...a),u=new e.Point(l.left,l.top);return l.setPositionByOrigin(u,i,c),l}};t.initAligningGuidelines=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.assign(n,o);const r=new Set,i=new Set;let l=!1;const u=new Map,g=t=>{const n=[t.calcTransformMatrix().toString(),t.width,t.height].join(),o=u.get(n);if(o)return o;const r=t.getCoords(),i=[e.util.makeBoundingBoxFromPoints(r),r];return u.set(n,i),i};function x(t){const e=t.target;e.setCoords(),l=!1,i.clear(),r.clear();const n=f(e),o=e.getBoundingRect();for(const t of n){const n=g(t)[0],{vLines:c,hLines:s}=d({activeObject:e,activeObjectRect:o,objectRect:n});c.forEach((t=>{i.add(JSON.stringify(t))})),s.forEach((t=>{r.add(JSON.stringify(t))}))}}function h(){t.clearContext(t.contextTop)}function y(){if(l){const e=[];for(const t of i)e.push(JSON.parse(t));for(const t of r)e.push(JSON.parse(t));c(t,e)}else{for(const e of i)s(t,JSON.parse(e));for(const e of r)a(t,JSON.parse(e))}}function m(){i.clear(),r.clear(),u.clear(),t.requestRenderAll()}return t.on("object:moving",x),t.on("before:render",h),t.on("after:render",y),t.on("mouse:up",m),()=>{t.off("object:moving",x),t.off("before:render",h),t.off("after:render",y),t.off("mouse:up",m)}},t.installOriginWrapperUpdater=(t,n)=>{e.BaseFabricObject._fromObject=y(e.BaseFabricObject._fromObject,t,n),e.FabricImage.fromObject=y(e.FabricImage.fromObject,t,n),e.Group.fromObject=y(e.Group.fromObject,t,n)},t.originUpdaterWrapper=y}));
//# sourceMappingURL=fabric-extensions.min.js.map

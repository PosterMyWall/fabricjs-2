{"version":3,"file":"Path.mjs","sources":["../../../src/shapes/Path.ts"],"sourcesContent":["import { config } from '../config';\nimport { SHARED_ATTRIBUTES } from '../parser/attributes';\nimport { parseAttributes } from '../parser/parseAttributes';\nimport type { XY } from '../Point';\nimport { Point } from '../Point';\nimport { makeBoundingBoxFromPoints } from '../util/misc/boundingBoxFromPoints';\nimport { toFixed } from '../util/misc/toFixed';\nimport {\n  getBoundsOfCurve,\n  joinPath,\n  makePathSimpler,\n  parsePath,\n} from '../util/path';\nimport { classRegistry } from '../ClassRegistry';\nimport { FabricObject, cacheProperties } from './Object/FabricObject';\nimport type {\n  TComplexPathData,\n  TPathSegmentInfo,\n  TSimplePathData,\n} from '../util/path/typedefs';\nimport type { FabricObjectProps, SerializedObjectProps } from './Object/types';\nimport type { ObjectEvents } from '../EventTypeDefs';\nimport type {\n  TBBox,\n  TClassProperties,\n  TSVGReviver,\n  TOptions,\n} from '../typedefs';\nimport { CENTER, LEFT, TOP } from '../constants';\nimport type { CSSRules } from '../parser/typedefs';\n\ninterface UniquePathProps {\n  sourcePath?: string;\n  path?: TSimplePathData;\n}\n\nexport interface SerializedPathProps\n  extends SerializedObjectProps,\n    UniquePathProps {}\n\nexport interface PathProps extends FabricObjectProps, UniquePathProps {}\n\nexport interface IPathBBox extends TBBox {\n  left: number;\n  top: number;\n  pathOffset: Point;\n}\n\nexport class Path<\n  Props extends TOptions<PathProps> = Partial<PathProps>,\n  SProps extends SerializedPathProps = SerializedPathProps,\n  EventSpec extends ObjectEvents = ObjectEvents,\n> extends FabricObject<Props, SProps, EventSpec> {\n  /**\n   * Array of path points\n   * @type Array\n   * @default\n   */\n  declare path: TSimplePathData;\n\n  declare pathOffset: Point;\n\n  declare sourcePath?: string;\n\n  declare segmentsInfo?: TPathSegmentInfo[];\n\n  static type = 'Path';\n\n  static cacheProperties = [...cacheProperties, 'path', 'fillRule'];\n\n  /**\n   * Constructor\n   * @param {TComplexPathData} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n   * @param {Partial<PathProps>} [options] Options object\n   * @return {Path} thisArg\n   */\n  constructor(\n    path: TComplexPathData | string,\n    // todo: evaluate this spread here\n    { path: _, left, top, ...options }: Partial<Props> = {},\n  ) {\n    super();\n    Object.assign(this, Path.ownDefaults);\n    this.setOptions(options);\n    this._setPath(path || [], true);\n    typeof left === 'number' && this.set(LEFT, left);\n    typeof top === 'number' && this.set(TOP, top);\n  }\n\n  /**\n   * @private\n   * @param {TComplexPathData | string} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n   * @param {boolean} [adjustPosition] pass true to reposition the object according to the bounding box\n   * @returns {Point} top left position of the bounding box, useful for complementary positioning\n   */\n  _setPath(path: TComplexPathData | string, adjustPosition?: boolean) {\n    this.path = makePathSimpler(Array.isArray(path) ? path : parsePath(path));\n    this.setBoundingBox(adjustPosition);\n  }\n\n  /**\n   * This function is an helper for svg import. it returns the center of the object in the svg\n   * untransformed coordinates, by look at the polyline/polygon points.\n   * @private\n   * @return {Point} center point from element coordinates\n   */\n  _findCenterFromElement(): Point {\n    const bbox = this._calcBoundsFromPath();\n    return new Point(bbox.left + bbox.width / 2, bbox.top + bbox.height / 2);\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} ctx context to render path on\n   */\n  _renderPathCommands(ctx: CanvasRenderingContext2D) {\n    const l = -this.pathOffset.x,\n      t = -this.pathOffset.y;\n\n    ctx.beginPath();\n\n    for (const command of this.path) {\n      switch (\n        command[0] // first letter\n      ) {\n        case 'L': // lineto, absolute\n          ctx.lineTo(command[1] + l, command[2] + t);\n          break;\n\n        case 'M': // moveTo, absolute\n          ctx.moveTo(command[1] + l, command[2] + t);\n          break;\n\n        case 'C': // bezierCurveTo, absolute\n          ctx.bezierCurveTo(\n            command[1] + l,\n            command[2] + t,\n            command[3] + l,\n            command[4] + t,\n            command[5] + l,\n            command[6] + t,\n          );\n          break;\n\n        case 'Q': // quadraticCurveTo, absolute\n          ctx.quadraticCurveTo(\n            command[1] + l,\n            command[2] + t,\n            command[3] + l,\n            command[4] + t,\n          );\n          break;\n\n        case 'Z':\n          ctx.closePath();\n          break;\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @param {CanvasRenderingContext2D} ctx context to render path on\n   */\n  _render(ctx: CanvasRenderingContext2D) {\n    this._renderPathCommands(ctx);\n    this._renderPaintInOrder(ctx);\n  }\n\n  /**\n   * Returns string representation of an instance\n   * @return {string} string representation of an instance\n   */\n  toString() {\n    return `#<Path (${this.complexity()}): { \"top\": ${this.top}, \"left\": ${\n      this.left\n    } }>`;\n  }\n\n  /**\n   * Returns object representation of an instance\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {Object} object representation of an instance\n   */\n  toObject<\n    T extends Omit<Props & TClassProperties<this>, keyof SProps>,\n    K extends keyof T = never,\n  >(propertiesToInclude: K[] = []): Pick<T, K> & SProps {\n    return {\n      ...super.toObject(propertiesToInclude),\n      path: this.path.map((pathCmd) => pathCmd.slice()),\n    };\n  }\n\n  /**\n   * Returns dataless object representation of an instance\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {Object} object representation of an instance\n   */\n  toDatalessObject<\n    T extends Omit<Props & TClassProperties<this>, keyof SProps>,\n    K extends keyof T = never,\n  >(propertiesToInclude: K[] = []): Pick<T, K> & SProps {\n    const o = this.toObject<T, K>(propertiesToInclude);\n    if (this.sourcePath) {\n      delete o.path;\n      o.sourcePath = this.sourcePath;\n    }\n    return o;\n  }\n\n  /**\n   * Returns svg representation of an instance\n   * @return {Array} an array of strings with the specific svg representation\n   * of the instance\n   */\n  _toSVG() {\n    const path = joinPath(this.path, config.NUM_FRACTION_DIGITS);\n    return [\n      '<path ',\n      'COMMON_PARTS',\n      `d=\"${path}\" stroke-linecap=\"round\" />\\n`,\n    ];\n  }\n\n  /**\n   * @private\n   * @return the path command's translate transform attribute\n   */\n  _getOffsetTransform() {\n    const digits = config.NUM_FRACTION_DIGITS;\n    return ` translate(${toFixed(-this.pathOffset.x, digits)}, ${toFixed(\n      -this.pathOffset.y,\n      digits,\n    )})`;\n  }\n\n  /**\n   * Returns svg clipPath representation of an instance\n   * @param {Function} [reviver] Method for further parsing of svg representation.\n   * @return {string} svg representation of an instance\n   */\n  toClipPathSVG(reviver?: TSVGReviver): string {\n    const additionalTransform = this._getOffsetTransform();\n    return (\n      '\\t' +\n      this._createBaseClipPathSVGMarkup(this._toSVG(), {\n        reviver,\n        additionalTransform: additionalTransform,\n      })\n    );\n  }\n\n  /**\n   * Returns svg representation of an instance\n   * @param {Function} [reviver] Method for further parsing of svg representation.\n   * @return {string} svg representation of an instance\n   */\n  toSVG(reviver?: TSVGReviver): string {\n    const additionalTransform = this._getOffsetTransform();\n    return this._createBaseSVGMarkup(this._toSVG(), {\n      reviver,\n      additionalTransform: additionalTransform,\n    });\n  }\n\n  /**\n   * Returns number representation of an instance complexity\n   * @return {number} complexity of this instance\n   */\n  complexity() {\n    return this.path.length;\n  }\n\n  setDimensions() {\n    this.setBoundingBox();\n  }\n\n  setBoundingBox(adjustPosition?: boolean) {\n    const { width, height, pathOffset } = this._calcDimensions();\n    this.set({ width, height, pathOffset });\n    // using pathOffset because it match the use case.\n    // if pathOffset change here we need to use left + width/2 , top + height/2\n    adjustPosition && this.setPositionByOrigin(pathOffset, CENTER, CENTER);\n  }\n\n  _calcBoundsFromPath(): TBBox {\n    const bounds: XY[] = [];\n    let subpathStartX = 0,\n      subpathStartY = 0,\n      x = 0, // current x\n      y = 0; // current y\n\n    for (const command of this.path) {\n      // current instruction\n      switch (\n        command[0] // first letter\n      ) {\n        case 'L': // lineto, absolute\n          x = command[1];\n          y = command[2];\n          bounds.push({ x: subpathStartX, y: subpathStartY }, { x, y });\n          break;\n\n        case 'M': // moveTo, absolute\n          x = command[1];\n          y = command[2];\n          subpathStartX = x;\n          subpathStartY = y;\n          break;\n\n        case 'C': // bezierCurveTo, absolute\n          bounds.push(\n            ...getBoundsOfCurve(\n              x,\n              y,\n              command[1],\n              command[2],\n              command[3],\n              command[4],\n              command[5],\n              command[6],\n            ),\n          );\n          x = command[5];\n          y = command[6];\n          break;\n\n        case 'Q': // quadraticCurveTo, absolute\n          bounds.push(\n            ...getBoundsOfCurve(\n              x,\n              y,\n              command[1],\n              command[2],\n              command[1],\n              command[2],\n              command[3],\n              command[4],\n            ),\n          );\n          x = command[3];\n          y = command[4];\n          break;\n\n        case 'Z':\n          x = subpathStartX;\n          y = subpathStartY;\n          break;\n      }\n    }\n    return makeBoundingBoxFromPoints(bounds);\n  }\n\n  /**\n   * @private\n   */\n  _calcDimensions(): IPathBBox {\n    const bbox = this._calcBoundsFromPath();\n\n    return {\n      ...bbox,\n      pathOffset: new Point(\n        bbox.left + bbox.width / 2,\n        bbox.top + bbox.height / 2,\n      ),\n    };\n  }\n\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `Path.fromElement`)\n   * @static\n   * @memberOf Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  static ATTRIBUTE_NAMES = [...SHARED_ATTRIBUTES, 'd'];\n\n  /**\n   * Creates an instance of Path from an object\n   * @static\n   * @memberOf Path\n   * @param {Object} object\n   * @returns {Promise<Path>}\n   */\n  static fromObject<T extends TOptions<SerializedPathProps>>(object: T) {\n    return this._fromObject<Path>(object, {\n      extraParam: 'path',\n    });\n  }\n\n  /**\n   * Creates an instance of Path from an SVG <path> element\n   * @static\n   * @memberOf Path\n   * @param {HTMLElement} element to parse\n   * @param {Partial<PathProps>} [options] Options object\n   */\n  static async fromElement(\n    element: HTMLElement | SVGElement,\n    options?: Partial<PathProps>,\n    cssRules?: CSSRules,\n  ) {\n    const { d, ...parsedAttributes } = parseAttributes(\n      element,\n      this.ATTRIBUTE_NAMES,\n      cssRules,\n    );\n    return new this(d, {\n      ...parsedAttributes,\n      ...options,\n      // we pass undefined to instruct the constructor to position the object using the bbox\n      left: undefined,\n      top: undefined,\n    });\n  }\n}\n\nclassRegistry.setClass(Path);\nclassRegistry.setSVGClass(Path);\n\n/* _FROM_SVG_START_ */\n"],"names":["Path","FabricObject","constructor","path","_","left","top","options","arguments","length","undefined","Object","assign","ownDefaults","setOptions","_setPath","set","LEFT","TOP","adjustPosition","makePathSimpler","Array","isArray","parsePath","setBoundingBox","_findCenterFromElement","bbox","_calcBoundsFromPath","Point","width","height","_renderPathCommands","ctx","l","pathOffset","x","t","y","beginPath","command","lineTo","moveTo","bezierCurveTo","quadraticCurveTo","closePath","_render","_renderPaintInOrder","toString","complexity","toObject","propertiesToInclude","map","pathCmd","slice","toDatalessObject","o","sourcePath","_toSVG","joinPath","config","NUM_FRACTION_DIGITS","_getOffsetTransform","digits","toFixed","toClipPathSVG","reviver","additionalTransform","_createBaseClipPathSVGMarkup","toSVG","_createBaseSVGMarkup","setDimensions","_calcDimensions","setPositionByOrigin","CENTER","bounds","subpathStartX","subpathStartY","push","getBoundsOfCurve","makeBoundingBoxFromPoints","fromObject","object","_fromObject","extraParam","fromElement","element","cssRules","d","parsedAttributes","parseAttributes","ATTRIBUTE_NAMES","_defineProperty","cacheProperties","SHARED_ATTRIBUTES","classRegistry","setClass","setSVGClass"],"mappings":"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"}